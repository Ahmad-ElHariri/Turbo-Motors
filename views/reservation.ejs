<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservation Page</title>
  <link rel="stylesheet" href="/css/common_styles.css">
  <link rel="stylesheet" href="/css/reservation.css">
</head>

<body>
  <nav>
    <div class="logo">Turbo Motors</div>
    <ul class="nav-links">
      <li><a href="/home">Home</a></li>
      <li><a href="/allcars">All Cars</a></li>
      <li><a href="/about">About Us</a></li>
      <li><a href="/contact">Contact</a></li>
      <% if (user) { %>
        <li><a href="/logout" class="btn">Logout</a></li>
        <li><a href="#" class="btn">Hi, <%= user.name %></a></li>
      <% } else { %>
        <li><a href="/login" class="btn">Sign In</a></li>
        <li><a href="/signup" class="btn">Sign Up</a></li>
      <% } %>
    </ul>
  </nav>

  <main class="reservation-ui">
    <form action="/reservation" method="POST" id="reservationForm">
      <div class="location-date-wrapper">
        <div class="location-select">
          <select id="pickupLocation" name="pickupLocation" required>
            <option disabled selected value="">Pick-up Location</option>
            <option value="kantari">Beirut City Centre Kantari - Lebanon</option>
            <option value="ashrafieh">Beirut Ashrafieh - Lebanon</option>
            <option value="sinelfil">Beirut Sin El Fil - Lebanon</option>
            <option value="airport">Beirut Rafic Hariri International Airport - Lebanon</option>
          </select>

          <div id="dropoffSection" style="display: none;">
            <select id="dropoffLocation" name="dropoffLocation">
              <option disabled selected value="">Drop-off Location</option>
              <option value="kantari">Beirut City Centre Kantari - Lebanon</option>
              <option value="ashrafieh">Beirut Ashrafieh - Lebanon</option>
              <option value="sinelfil">Beirut Sin El Fil - Lebanon</option>
              <option value="airport">Beirut Rafic Hariri International Airport - Lebanon</option>
            </select>
          </div>
        </div>

        <div class="datetime-select">
          <input type="date" id="pickupDate" name="pickupDate" required>
          <input type="time" id="pickupTime" name="pickupTime" required>
          <span class="to-label">To</span>
          <input type="date" id="dropoffDate" name="dropoffDate" required>
          <input type="time" id="dropoffTime" name="dropoffTime" required>
        </div>
      </div>

      <div class="map-box">
        <div id="map"></div>
      </div>

      <div class="branch-details">
        <div id="branchInfo">
          <h3>Branch Information</h3>
          <p>Select a location to view details.</p>
        </div>
        <button type="submit" class="btn red-btn">Search for Vehicles</button>
        <div class="options">
          <label>
            <input type="checkbox" id="returnDiffCheck" name="returnDifferent"> Return to Different Location
          </label>
          <label>
            <input type="checkbox" name="over30" checked> Driver aged between 18 & 75
          </label>
        </div>
      </div>
    </form>
  </main>

  <footer>
    <div class="container footer-content">
      <p>&copy; 2025 Turbo Motors. All Rights Reserved.</p>
    </div>
  </footer>

  <script>
    // Save to cookies on submit
    document.getElementById("reservationForm").addEventListener("submit", () => {
      const fields = ["pickupLocation", "dropoffLocation", "pickupDate", "pickupTime", "dropoffDate", "dropoffTime"];
      fields.forEach(id => {
        const value = document.getElementById(id)?.value;
        if (value) document.cookie = `${id}=${value}; path=/; max-age=7200`; // 2 hours
      });
    });

    // Restore from cookies
    window.addEventListener("DOMContentLoaded", () => {
      const cookies = document.cookie.split(";").reduce((acc, c) => {
        const [key, val] = c.trim().split("=");
        acc[key] = decodeURIComponent(val);
        return acc;
      }, {});

      ["pickupLocation", "dropoffLocation", "pickupDate", "pickupTime", "dropoffDate", "dropoffTime"].forEach(id => {
        const el = document.getElementById(id);
        if (el && cookies[id]) {
          el.value = cookies[id];
          if (id === "dropoffLocation") document.getElementById("dropoffSection").style.display = "block";
        }
      });
    });
  </script>

  <script src="/Js/reservation.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJhUB4auZ8P1buHd4bkPATXljVUb4-6zk&callback=initMap"
    async defer></script>
</body>

</html>
